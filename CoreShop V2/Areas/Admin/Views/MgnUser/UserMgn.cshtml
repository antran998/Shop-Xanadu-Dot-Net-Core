@model CoreShop_V2.Areas.Admin.ViewModel.UserManagementViewModel

@{
    ViewData["Title"] = "UserMgn";
    ViewData["Section"] = "User Management";
}

<!-- Container fluid  -->
<div class="container-fluid">
    <!-- Start Page Content -->

    @foreach (var role in Model.UserWithRole)
    {
        <div class="row item-row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title" data-name="@role.RoleName">@role.RoleName</h4>
                        <span style="display:none" class="cate-id">@role.RoleId</span>
                        <button type="button" class="btn btn-success add-user-btn" data-toggle="modal" data-target="#AddUserModal"><i class="fas fa-plus"></i> Add User</button>
                        <div class="table-responsive m-t-40">
                            <table class="user-table display nowrap table table-hover table-striped table-bordered" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th class="id-row">Id</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Address</th>
                                        <th>Phone</th>
                                        <th>Money spended</th>
                                        <th>Options</th>
                                    </tr>
                                </thead>
                                @*<tbody>
                                        @foreach (var item in type.Products)
                                        {
                                            <tr>
                                                <td class="id-row">@item.ProductId</td>
                                                <td><img class="img-row" src="~/assets/images/items/@item.Image" alt="Hình sản phẩm" /></td>
                                                <td>@item.ProductName</td>
                                                <td>@item.Price</td>
                                                <td>@item.DiscountPrice</td>
                                                <td>@item.Describe</td>
                                                <td>
                                                    <button class="btn btn-danger btn-rounded delete-btn">Xóa</button>
                                                    <button class="btn btn-info btn-rounded edit-button" data-toggle="modal" data-target="#EditModal">Sửa</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>*@
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    <!-- End PAge Content -->
    <div id="AddUserModal" class="modal animated fadeIn" data-easein="fadeIn" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form enctype="multipart/form-data" asp-action="CreateUser" asp-controller="MgnUser" class="modal-content" method="post">
                <div class="modal-header">
                    <h4 class="modal-title">Add User</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                </div>
                <div class="modal-body">
                    <div class="form-group row" style="display:none;">
                        <label asp-for="@Model.CreateUser.UserRole" class="col-lg-4 col-form-label">RoleName <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.CreateUser.UserRole" id="roleName" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.UserRole" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.CreateUser.CustomerName" class="col-lg-4 col-form-label">Name <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.CreateUser.CustomerName" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.CustomerName" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.CreateUser.CustomerEmail" class="col-lg-4 col-form-label">Email <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.CreateUser.CustomerEmail" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.CustomerEmail" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.CreateUser.CustomerAddress" class="col-lg-4 col-form-label">Address <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.CreateUser.CustomerAddress" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.CustomerAddress" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.CreateUser.CustomerPhone" class="col-lg-4 col-form-label">Phone <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.CreateUser.CustomerPhone" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.CustomerPhone" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.CreateUser.Password" class="col-lg-4 col-form-label">Password <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="password" asp-for="@Model.CreateUser.Password" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.Password" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.CreateUser.ConfirmPassword" class="col-lg-4 col-form-label">Confirm <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="password" asp-for="@Model.CreateUser.ConfirmPassword" class="form-control" placeholder="Type in ..">
                            <span asp-validation-for="@Model.CreateUser.ConfirmPassword" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Close</button>
                    <button type="submit" class="btn btn-info confirm-create"><i class="fas fa-plus-square"></i> Create</button>
                </div>
            </form>
        </div>
    </div>
    <div id="EditModal" class="modal animated fadeIn" data-easein="fadeIn" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form class="modal-content" asp-action="UpdateUser" asp-controller="MgnUser" method="post">
                <div class="modal-header">
                    <h4 class="modal-title">Sửa thông tin</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                </div>
                <div class="modal-body">
                    <div class="form-group row" style="display:none">
                        <label asp-for="@Model.UpdateUser.UserId" class="col-lg-4 col-form-label">User Id <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.UpdateUser.UserId" class="form-control" id="editId" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.UserId" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row" style="display:none">
                        <label asp-for="@Model.UpdateUser.RoleId" class="col-lg-4 col-form-label">Role Id <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.UpdateUser.RoleId" class="form-control" id="editRole" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.RoleId" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.UpdateUser.CustomerName" class="col-lg-4 col-form-label">Name <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.UpdateUser.CustomerName" class="form-control" id="editName" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.CustomerName" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.UpdateUser.CustomerEmail" class="col-lg-4 col-form-label">Email <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.UpdateUser.CustomerEmail" class="form-control" id="editEmail" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.CustomerEmail" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.UpdateUser.CustomerAddress" class="col-lg-4 col-form-label">Address <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.UpdateUser.CustomerAddress" class="form-control" id="editAddress" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.CustomerAddress" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.UpdateUser.CustomerPhone" class="col-lg-4 col-form-label">Phone <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="text" asp-for="@Model.UpdateUser.CustomerPhone" class="form-control" id="editPhone" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.CustomerPhone" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.UpdateUser.Password" class="col-lg-4 col-form-label">Password <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="password" asp-for="@Model.UpdateUser.Password" class="form-control" id="editPassword" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.Password" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label asp-for="@Model.UpdateUser.ConfirmPassword" class="col-lg-4 col-form-label">Confirm <span class="text-danger">*</span></label>
                        <div class="col-lg-8">
                            <input type="password" asp-for="@Model.UpdateUser.ConfirmPassword" class="form-control" id="editConfirm" placeholder="Type in ..">
                            <span asp-validation-for="@Model.UpdateUser.ConfirmPassword" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Close</button>
                    <button type="submit" class="btn btn-info confirm-edit"><i class="fas fa-user-edit"></i> Confirm</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- End Container fluid  -->
@section Scripts{
    <script src="~/assets1/js/lib/datatables/datatables.min.js"></script>
    <script src="~/assets1/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js"></script>
    <script src="~/assets1/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js"></script>
    <script src="~/assets1/js/lib/datatables/cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script src="~/assets1/js/lib/datatables/cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
    <script src="~/assets1/js/lib/datatables/cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
    <script src="~/assets1/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js"></script>
    <script src="~/assets1/js/lib/datatables/cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js"></script>
    <script src="~/assets1/js/lib/datatables/datatables-init.js" asp-append-version="true"></script>
    <script>
        $(function () {            

            $('.add-user-btn').click(function () {
                var category = $(this).parent().find(".card-title").html();
                $('#roleName').val(category);
            })

            var confirmed = window.location.href.search("created");
            if (confirmed != -1) {
                history.pushState(null, null, window.location.pathname);
                Swal.fire({
                    type: 'success',
                    text: 'Success'
                })
            }
        });

        function UpdateUser(obj) {
            var thisRow = $(obj).parents("tr");
            var thisType = window.location.pathname.split("/");
            thisType = thisType[2];            
            $('#editId').val($(thisRow).find("td:first-child").html());
            $('#editName').val($(thisRow).find("td:nth-child(2)").html());
            $('#editEmail').val($(thisRow).find("td:nth-child(3)").html());
            $('#editAddress').val($(thisRow).find("td:nth-child(4)").html());
            $('#editPhone').val($(thisRow).find("td:nth-child(5)").html());
            $('#editRole').val(thisType);
        }

        function DeleteUser(obj) {
            var thisUser = $(obj).parents('tr').find('td:first-child');
            Swal.fire({
                type: 'warning',
                text: 'Are you sure ?',
                customClass: {
                    confirmButton: 'delete-user-confirm'
                }
            })
            $(".delete-user-confirm").click(function () {
                var thisRow = $(thisUser).parent();
                $.ajax({
                    url: "/DeleteUser",
                    type: "POST",
                    data: {
                        UserId: $(thisUser).html()
                    },
                    dataType: "json",
                    success: function (result) {
                        if (result == "success") {
                            $(thisRow).addClass("animated fadeOutLeft");
                            $(thisRow).slideUp();
                            setTimeout(function () {
                                $('.user-table').DataTable().ajax.reload(null,false);
                            }, 800)
                        }
                    }
                });
            })
        }

    </script>
}